import CloudBanner from '../../components/CloudBanner'
import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'
import PlatformTabs from '../../components/PlatformTabs'
import PlatformTabItem from '../../components/PlatformTabItem'

import WagmiInstallation from './wagmi/about/installation.mdx'
import WagmiInstallationExpo from './wagmi/about/installation-expo.mdx'
import WagmiImplementation from './wagmi/about/implementation.mdx'

import Ethers5Installation from './ethers5/about/installation.mdx'
import Ethers5InstallationExpo from './ethers5/about/installation-expo.mdx'
import Ethers5Implementation from './ethers5/about/implementation.mdx'

# React Native

## Introduction

Web3Modal SDK has support for [Wagmi v1](https://1.x.wagmi.sh/) and [Ethers v5](https://docs.ethers.org/v5/). Choose one of these Ethereum libraries to get started.

<CloudBanner />

## Installation

<Tabs groupId="platform">
<TabItem value="rn-cli" label="React Native CLI">

<PlatformTabs groupId="eth-lib" activeOptions={["wagmi1", "ethers5"]}>

<PlatformTabItem value="wagmi1">
  <WagmiInstallation />
</PlatformTabItem>

<PlatformTabItem value="ethers5">
  :::caution
  Ethers v5 support is currently in alpha.
  :::
  <Ethers5Installation />
</PlatformTabItem>

</PlatformTabs>

</TabItem>

<TabItem value="expo" label="Expo">

<PlatformTabs groupId="eth-lib" activeOptions={["wagmi1", "ethers5"]}>

<PlatformTabItem value="wagmi1">
  <WagmiInstallationExpo />
</PlatformTabItem>

<PlatformTabItem value="ethers5">
  :::caution
  Ethers v5 support is currently in alpha.
  :::
  <Ethers5InstallationExpo />
</PlatformTabItem>

</PlatformTabs>


</TabItem>

</Tabs>

## Implementation

<PlatformTabs groupId="eth-lib" activeOptions={["wagmi1", "ethers5"]}>

<PlatformTabItem value="wagmi1">
  <WagmiImplementation />
</PlatformTabItem>

<PlatformTabItem value="ethers5">
  <Ethers5Implementation />
</PlatformTabItem>

</PlatformTabs>

## Enable Wallet Detection

:::info Note

Make sure your have `@walletconnect/react-native-compat@2.10.5` or higher.

:::

To enable WalletConnectModal to detect wallets installed on the device, you need to make specific changes to the native code of your project.

<Tabs groupId="platform">
  <TabItem value="rn-cli" label="React Native CLI">

#### For iOS:

1. Open your `Info.plist` file.
2. Locate the `<key>LSApplicationQueriesSchemes</key>` section.
3. Add the desired wallet schemes as string entries within the `<array>`. These schemes represent the wallets you want to detect.
4. Refer to our [Info.plist example file](https://github.com/WalletConnect/react-native-examples/blob/main/dapps/ModalUProvider/ios/ModalUProvider/Info.plist) for a detailed illustration.

Example:

```xml
<key>LSApplicationQueriesSchemes</key>
<array>
  <string>metamask</string>
  <string>trust</string>
  <string>safe</string>
  <string>rainbow</string>
  <string>uniswap</string>
  <!-- Add other wallet schemes names here -->
</array>
```

#### For Android:

1. Open your `AndroidManifest.xml` file.
2. Locate the `<queries>` section.
3. Add the desired wallet package names as `<package>` entries within the `<queries>`. These package names correspond to the wallets you want to detect.
4. Refer to our [AndroidManifest.xml example file](https://github.com/WalletConnect/react-native-examples/blob/main/dapps/ModalUProvider/android/app/src/main/AndroidManifest.xml) for detailed guidance.

Example:

```xml
<queries>
  <package android:name="io.metamask"/>
  <package android:name="com.wallet.crypto.trustapp"/>
  <package android:name="io.gnosis.safe"/>
  <package android:name="me.rainbow"/>
  <!-- Add other wallet package names here -->
</queries>
```

</TabItem>

<TabItem value="expo" label="Expo">

#### For iOS only:

To enable WalletConnectModal to detect wallets installed on the device in your Expo project for iOS, follow these steps:

1. Open your `app.json` (or `app.config.js`) file.
2. Locate the ios section within the configuration.
3. Add the `infoPlist` object if it doesn't exist, and within it, include the `LSApplicationQueriesSchemes` array. This array will contain the desired wallet schemes you want to detect.
4. Add the wallet schemes to the `LSApplicationQueriesSchemes` array.

Your configuration should look like this:

```json
{
  "expo": {
    "ios": {
      "infoPlist": {
        "LSApplicationQueriesSchemes": [
          "metamask",
          "trust",
          "safe",
          "rainbow",
          "uniswap"
          // Add other wallet schemes names here
        ]
      }
    }
  }
}
```

</TabItem>

</Tabs>

## Enable Coinbase Wallet

<Tabs groupId="platform">
<TabItem value="rn-cli" label="React Native CLI">

Follow these steps to install Coinbase SDK in your project along with our custom Wagmi connector. Check <a href="https://mobilewalletprotocol.github.io/wallet-mobile-sdk/docs/client-sdk/rn-install">here</a> for more detailed information.

- Note: Coinbase SDK is [not compatible with Expo Go](https://github.com/MobileWalletProtocol/wallet-mobile-sdk/issues/206)

1. Enable Expo Modules in your project running: `npx install-expo-modules@latest`

2. Install Coinbase SDK

```bash npm2yarn
npm install @coinbase/wallet-mobile-sdk react-native-mmkv
```

3. Install our custom connector

<PlatformTabs groupId="eth-lib" activeOptions={["wagmi1", "ethers5"]}>

<PlatformTabItem value="wagmi1">
  ```bash npm2yarn
    npm install @web3modal/coinbase-wagmi-react-native
  ```
</PlatformTabItem>

<PlatformTabItem value="ethers5">
  ```bash npm2yarn
    npm install @web3modal/coinbase-ethers-react-native
  ```
</PlatformTabItem>

</PlatformTabs>

4. Run pod-install

```
npx pod-install
```

5. Enable Deeplink handling in your project following <a href="https://reactnative.dev/docs/linking?syntax=android#enabling-deep-links">React Native docs</a>

6. Add Coinbase package in your AndroidManifest.xml and Info.Plist

```xml
// AndroidManifest.xml

<queries>
  <!-- other queries -->
  <package android:name="org.toshi" />
</queries>
```

```xml
// Info.plist

<key>LSApplicationQueriesSchemes</key>
<array>
  <!-- other schemes -->
  <string>cbwallet</string>
</array>
```

7. Add Coinbase reponse handler in your app. More info <a href="https://mobilewalletprotocol.github.io/wallet-mobile-sdk/docs/client-sdk/rn-setup#listening-for-responses">here</a>

```tsx
import { handleResponse } from '@coinbase/wallet-mobile-sdk'

// Your app's deeplink handling code
useEffect(() => {
  const sub = Linking.addEventListener('url', ({ url }) => {
    const handledBySdk = handleResponse(new URL(url))
    if (!handledBySdk) {
      // Handle other deeplinks
    }
  })

  return () => sub.remove()
}, [])
```


8. Initialize `CoinbaseWagmiConnector` and add it in `extraConnectors`

<PlatformTabs groupId="eth-lib" activeOptions={["wagmi1", "ethers5"]}>

<PlatformTabItem value="wagmi1">
  ```tsx
    import { CoinbaseConnector } from '@web3modal/coinbase-wagmi-react-native'

    const coinbaseConnector = new CoinbaseConnector({
      chains,
      options: {
        redirect: 'YOUR_APP_SCHEME://'
      }
    })

    const wagmiConfig = defaultWagmiConfig({
      chains,
      projectId,
      metadata,
      extraConnectors: [coinbaseConnector]
    })
  ```
</PlatformTabItem>

<PlatformTabItem value="ethers5">
  ```tsx
    import { CoinbaseProvider } from '@web3modal/coinbase-ethers-react-native'

    const coinbaseProvider = new CoinbaseProvider({
      redirect: 'YOUR_APP_SCHEME://',
      rpcUrl: mainnet.rpcUrl,
    })

    const config = defaultConfig({
      metadata,
      coinbase: coinbaseProvider,
    })
  ```
</PlatformTabItem>

</PlatformTabs>


Check <a href="https://mobilewalletprotocol.github.io/wallet-mobile-sdk/docs/client-sdk/rn-install">Coinbase docs</a> for more detailed information.

</TabItem>

<TabItem value="expo" label="Expo">
  Coinbase SDK doesn't support Expo Projects. More info <a href="https://github.com/MobileWalletProtocol/wallet-mobile-sdk/issues/206#issuecomment-1468836345">here</a>
</TabItem>

</Tabs>